{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { BIconStar, BIconStarFill, BIconTrash } from 'bootstrap-vue';\nimport axios from 'axios';\nimport _ from 'underscore';\nexport default {\n  name: 'HorsesToWatchView',\n  components: {\n    BIconStar,\n    BIconStarFill,\n    BIconTrash\n  },\n  props: [],\n  data() {\n    return {\n      horsesToWatch: [],\n      filter: '',\n      horseFields: [{\n        key: \"raceDate\",\n        label: \"Race\"\n      }, {\n        key: \"position\",\n        label: \"Fin\"\n      }, {\n        key: \"comment\"\n      }, {\n        key: \"flag\"\n      }, {\n        key: 'deleteButton',\n        label: \"\"\n      }]\n    };\n  },\n  mounted() {\n    this.getHorsesToWatch();\n  },\n  computed: {\n    filtered() {\n      return _.sortBy(_.filter(this.horsesToWatch, function (h) {\n        return h.name.indexOf(this.filter) > -1 || this.filter == '';\n      }), function (h) {\n        var s = 0;\n        if (h.flag != \"Star\") s += 10000000;\n        if (h.raceNotes.length == 0) return s;\n        return s + this.dateToNumber(h.raceNotes[h.raceNotes.length - 1].raceDate);\n      });\n    }\n  },\n  methods: {\n    async getHorsesToWatch() {\n      try {\n        const response = await axios({\n          url: 'getHorsesToWatch/',\n          method: 'GET',\n          baseURL: 'http://localhost:8080/jpp/rest/remote/'\n        });\n        this.horsesToWatch = response.data;\n      } catch (err) {\n        console.log(err.response);\n      }\n    },\n    async save() {\n      try {\n        this.loading = true;\n        var formData = new FormData();\n        formData.append(\"data\", JSON.stringify(this.horsesToWatch));\n        await axios({\n          url: 'saveHorsesToWatch',\n          method: 'POST',\n          baseURL: 'http://localhost:8080/jpp/rest/remote/',\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          },\n          data: formData\n        });\n        //console.log(response);\n        this.loading = false;\n      } catch (err) {\n        console.log(err);\n      }\n    },\n    dateToNumber(date) {\n      return date[0] * 10000 + date[1] * 100 + date[0];\n    },\n    formatDate(date) {\n      return date[1] + \"/\" + date[2] + \"/\" + date[0];\n    },\n    removeHorse(horse) {\n      this.horsesToWatch = _.reject(this.horsesToWatch, function (h) {\n        return h.name == horse.name;\n      });\n    },\n    removeRaceNote(horse, note) {\n      horse.raceNotes = _.reject(horse.raceNotes, function (n) {\n        return n.raceDate == note.raceDate && n.track == note.track && n.raceNumber == note.raceNumber;\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsEA;AACA;AACA;AAEA;EACAA;EACAC;IACAC;IAAAC;IAAAC;EACA;EACAC;EACAC;IACA;MACAC;MACAC;MACAC,cACA;QAAAC;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;MAAA,GACA;QAAAA;MAAA,GACA;QAAAA;QAAAC;MAAA;IAEA;EACA;EACAC;IACA;EACA;EACAC;IACAC;MAEA;QACA;MACA;QACA;QACA;QACA;QACA;MAEA;IACA;EACA;EACAC;IACA;MACA;QACA;UACAC;UACAC;UACAC;QACA;QACA;MACA;QACAC;MAEA;IACA;IACA;MACA;QACA;QACA;QACAC;QACA;UACAJ;UACAC;UACAC;UACAG;YACA;UACA;UACAf;QACA;QACA;QACA;MACA;QACAa;MAEA;IACA;IACAG;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;QACA;MACA;IACA;IACAC;MACAC;QACA;MACA;IACA;EAEA;AACA","names":["name","components","BIconStar","BIconStarFill","BIconTrash","props","data","horsesToWatch","filter","horseFields","key","label","mounted","computed","filtered","methods","url","method","baseURL","console","formData","headers","dateToNumber","formatDate","removeHorse","removeRaceNote","horse"],"sourceRoot":"src/components","sources":["HorsesToWatchView.vue"],"sourcesContent":["<template>\n    <div>\n        <b-row>\n            <b-col>\n                <b-form inline>\n                    <label class=\"sr-only\" for=\"name\">Name</label>\n                    <b-form-input\n                        id=\"name\"\n                        class=\"mb-2 mr-sm-2 mb-sm-0\"\n                        placeholder=\"Filter Horse Name\"\n                        v-model=\"filter\"\n                    ></b-form-input>\n                </b-form>\n            </b-col>\n            <b-col>\n                <b-button variant=\"primary\" @click=\"getHorsesToWatch()\" class=\"mx-2\">Refresh</b-button>\n                <b-button variant=\"primary\" @click=\"save()\">Save</b-button>\n            </b-col>\n        </b-row>\n        <b-row class=\"mt-2\">\n            <b-card\n                v-for=\"horse in horsesToWatch\" :key=\"horse.name\"\n                tag=\"article\"\n                style=\"min-width: 300px;\"\n                class=\"m-2\"\n            >\n                <template #header>\n                    <h6 class=\"mb-0\">\n                        <b-row>\n                            <b-col>\n                                <b-icon-star-fill variant=\"success\" v-if=\"horse.flag =='Star'\" @click=\"horse.flag = ''\"></b-icon-star-fill>\n                                <b-icon-star v-else @click=\"horse.flag = 'Star'\"></b-icon-star>\n                                {{horse.name}}\n                            </b-col>\n                            <b-col class=\"text-right\">\n                                <b-icon-trash variant=\"danger\" @click=\"removeHorse(horse)\"></b-icon-trash>\n                            </b-col>\n                        </b-row>\n                    </h6>\n                </template>\n\n                <b-form-textarea\n                    v-model=\"horse.comment\"\n                    placeholder=\"Enter something...\"\n                    max-rows=\"4\"\n                ></b-form-textarea>\n\n                <b-table \n                    :items=\"horse.raceNotes\"\n                    :fields=\"horseFields\"\n                    small\n                    class=\"mx-2\"\n                >\n                    <template #cell(raceDate)=\"row\">\n                        {{formatDate(row.item.raceDate)}}<sup>{{row.item.raceNumber}}</sup> {{row.item.track}}\n                    </template>\n                    <template #cell(position)=\"row\">\n                        {{row.item.position}}<sup v-if=\"row.item.beatenLengths >0\">{{row.item.beatenLengths}}</sup>\n                    </template>\n                    <template #cell(deleteButton)=\"row\">\n                        <b-icon-trash variant=\"danger\" @click=\"removeRaceNote(horse, row.item)\"></b-icon-trash>\n                    </template>                    \n                </b-table>\n\n            </b-card>            \n        </b-row>\n    </div>\n</template>\n\n<script>\nimport { BIconStar, BIconStarFill, BIconTrash } from 'bootstrap-vue'\nimport axios from 'axios'\nimport _ from 'underscore'\n\nexport default {\n    name: 'HorsesToWatchView',\n    components: {\n\t\tBIconStar, BIconStarFill, BIconTrash\n    },\n    props : [],\n    data () {\n\t\treturn {\n            horsesToWatch: [],\n\t\t\tfilter: '',\n            horseFields: [\n                {key: \"raceDate\", label: \"Race\"},\n                {key: \"position\" , label: \"Fin\"},\n                {key: \"comment\"},\n                {key: \"flag\"},\n                {key: 'deleteButton', label: \"\"}\n            ]\n        }\n    },\n    mounted() {\n\t\tthis.getHorsesToWatch();\n    },\n    computed: {\n        filtered () {\n\n            return _.sortBy(_.filter(this.horsesToWatch, function(h){\n                return h.name.indexOf(this.filter) > -1 || this.filter == '';\n            }), function (h) {\n                var s = 0;\n                if (h.flag != \"Star\") s += 10000000;\n                if (h.raceNotes.length == 0) return s;\n                return s + this.dateToNumber(h.raceNotes[h.raceNotes.length - 1].raceDate);\n\n            });\n        }\n    },\n    methods: {\n\t\tasync getHorsesToWatch() {\n\t\t\ttry {\n\t\t\t\tconst response = await axios({\n\t\t\t\t\turl: 'getHorsesToWatch/',\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\tbaseURL: 'http://localhost:8080/jpp/rest/remote/'\n\t\t\t\t});\n\t\t\t\tthis.horsesToWatch = response.data;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.log(err.response);\n\t\t\t\t\t\t\t\n\t\t\t}\t\n\t\t},\n\t\tasync save() {\n            try {\n\t\t\t\tthis.loading = true;\n                var formData = new FormData();\n                formData.append(\"data\", JSON.stringify(this.horsesToWatch));\n                await axios({\n                    url: 'saveHorsesToWatch',\n                    method: 'POST',\n                    baseURL: 'http://localhost:8080/jpp/rest/remote/',\n                    headers: {\n                        'Content-Type': 'multipart/form-data'\n                    },\n                    data: formData\n                });\n                //console.log(response);\n\t\t\t\tthis.loading = false;\n            } catch (err) {\n                console.log(err);\n                \n            }\n\t\t},     \n        dateToNumber (date) {\n            return date[0] * 10000 + date[1] * ( 100) + date[0];\n        },\n\t\tformatDate (date) {\n\t\t\treturn date[1] + \"/\" + date[2] + \"/\" + date[0];\n\t\t},\n        removeHorse (horse) {\n            this.horsesToWatch = _.reject(this.horsesToWatch, function(h){\n                return h.name == horse.name;\n            })\n        },\n        removeRaceNote (horse, note) {\n            horse.raceNotes = _.reject(horse.raceNotes, function(n){\n                return n.raceDate == note.raceDate && n.track == note.track && n.raceNumber == note.raceNumber;\n            })\n        },\n\n    }\n}\n</script>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}